"""
Seed script to populate knowledge base with common IT problems and solutions.
Run this after creating the database to add initial knowledge base articles.
"""
from app.core.database import SessionLocal, init_db
from app.models.knowledge_base import KnowledgeBase
from app.models.ticket import TicketCategory


def seed_knowledge_base():
    # Initialize database
    init_db()
    db = SessionLocal()

    # Clear existing knowledge base (for development)
    db.query(KnowledgeBase).delete()

    knowledge_articles = [
        # Категория: Доступы и пароли
        {
            "category": TicketCategory.ACCESS_PASSWORDS,
            "title": "Забыл пароль от Active Directory",
            "problem": "Не могу войти в систему, забыл пароль от учетной записи Windows",
            "solution": """1. Нажмите Ctrl+Alt+Delete на экране входа
2. Выберите "Сменить пароль"
3. Если не работает, обратитесь к системному администратору или позвоните на внутренний номер IT-поддержки
4. Администратор сбросит пароль через Active Directory Users and Computers
5. При первом входе система попросит установить новый пароль""",
            "keywords": "пароль, забыл, active directory, войти, логин, учетная запись, доступ"
        },
        {
            "category": TicketCategory.ACCESS_PASSWORDS,
            "title": "Не могу войти в корпоративную почту",
            "problem": "Ошибка при входе в Outlook или веб-почту компании",
            "solution": """1. Проверьте раскладку клавиатуры (русская/английская)
2. Убедитесь что Caps Lock выключен
3. Попробуйте сбросить пароль через форму восстановления
4. Очистите кэш браузера (Ctrl+Shift+Delete)
5. Попробуйте войти в режиме инкогнито
6. Проверьте правильность адреса почтового сервера в настройках Outlook
7. Если не помогло - обратитесь в IT-поддержку""",
            "keywords": "почта, outlook, email, вход, не могу войти, логин, пароль"
        },
        {
            "category": TicketCategory.ACCESS_PASSWORDS,
            "title": "Нужен доступ к общей папке",
            "problem": "Не вижу общую сетевую папку или нет прав доступа",
            "solution": """1. Проверьте подключение к корпоративной сети (VPN если работаете удаленно)
2. Откройте Проводник Windows
3. В адресной строке введите: \\\\server\\share (уточните путь у коллег)
4. Если папка не открывается - проблема с правами доступа
5. Создайте заявку на доступ с указанием:
   - Название общей папки
   - Уровень доступа (чтение/запись)
   - Обоснование необходимости доступа
6. Администратор добавит вас в нужную группу безопасности""",
            "keywords": "общая папка, сетевая папка, доступ, права, share, не вижу папку"
        },

        # Категория: Сеть и интернет
        {
            "category": TicketCategory.NETWORK,
            "title": "Не подключается VPN",
            "problem": "Ошибка при подключении к корпоративному VPN",
            "solution": """1. Проверьте интернет-соединение (откройте любой сайт)
2. Убедитесь что используете правильные учетные данные
3. Проверьте дату и время на компьютере (должны быть точными)
4. Попробуйте переподключиться к WiFi
5. Перезапустите VPN клиент
6. Если используется Cisco AnyConnect/FortiClient:
   - Удалите сохраненные настройки подключения
   - Создайте подключение заново
7. Временно отключите антивирус и файрвол
8. Перезагрузите компьютер
9. Если ошибка "Certificate error" - обновите сертификаты VPN""",
            "keywords": "vpn, не подключается, ошибка, удаленный доступ, anyconnect, forticlient"
        },
        {
            "category": TicketCategory.NETWORK,
            "title": "Медленный интернет",
            "problem": "Низкая скорость интернета на рабочем месте",
            "solution": """1. Проверьте скорость интернета на speedtest.net
2. Закройте лишние программы и вкладки браузера
3. Проверьте кто еще использует сеть (большие загрузки)
4. Отключите торренты и загрузки файлов
5. Если используете WiFi:
   - Подойдите ближе к точке доступа
   - Попробуйте подключиться к другой WiFi сети
   - Используйте кабельное подключение если возможно
6. Перезагрузите роутер (выключить на 30 сек)
7. Проверьте фоновые обновления Windows
8. Просканируйте систему антивирусом
9. Если проблема массовая - сообщите в IT""",
            "keywords": "медленный интернет, низкая скорость, тормозит, wifi, сеть"
        },
        {
            "category": TicketCategory.NETWORK,
            "title": "Заблокирован доступ к сайту",
            "problem": "Не открывается нужный рабочий сайт",
            "solution": """1. Проверьте правильность адреса сайта
2. Попробуйте открыть в режиме инкогнито
3. Очистите кэш браузера
4. Попробуйте другой браузер
5. Проверьте не заблокирован ли сайт корпоративным фильтром
6. Если сайт нужен для работы:
   - Создайте заявку на разблокировку
   - Укажите URL сайта и обоснование
   - Получите одобрение руководителя
7. IT-администратор добавит сайт в белый список""",
            "keywords": "заблокирован сайт, не открывается, доступ запрещен, firewall"
        },

        # Категория: Принтеры
        {
            "category": TicketCategory.PRINTERS,
            "title": "Не работает принтер - застряла бумага",
            "problem": "Принтер не печатает из-за замятия бумаги",
            "solution": """1. Отмените все задания печати на компьютере
2. Выключите принтер кнопкой питания
3. Откройте все крышки и лотки принтера
4. Осторожно извлеките застрявшую бумагу:
   - Тяните по направлению движения бумаги
   - Не рвите бумагу, доставайте целиком
   - Проверьте все отсеки
5. Закройте все крышки
6. Включите принтер
7. Дождитесь инициализации
8. Попробуйте распечатать тестовую страницу
9. Если проблема повторяется - вызовите техника""",
            "keywords": "принтер, застряла бумага, замятие, не печатает, paper jam"
        },
        {
            "category": TicketCategory.PRINTERS,
            "title": "Драйвер принтера не установлен",
            "problem": "Компьютер не видит принтер или просит установить драйвер",
            "solution": """1. Откройте "Панель управления" → "Устройства и принтеры"
2. Нажмите "Добавить принтер"
3. Выберите "Добавить сетевой принтер"
4. Дождитесь поиска принтеров в сети
5. Выберите нужный принтер из списка
6. Если принтера нет в списке:
   - Узнайте IP-адрес или имя принтера
   - Выберите "Добавить принтер по IP-адресу"
   - Введите IP-адрес
7. Windows автоматически загрузит драйвер
8. Если не загрузился:
   - Скачайте драйвер с сайта производителя
   - Или обратитесь в IT-поддержку
9. Установите драйвер и назначьте принтер по умолчанию""",
            "keywords": "драйвер принтера, не установлен, не видит принтер, подключить принтер"
        },
        {
            "category": TicketCategory.PRINTERS,
            "title": "Зависла очередь печати",
            "problem": "Документы не печатаются, висят в очереди",
            "solution": """1. Откройте "Панель управления" → "Устройства и принтеры"
2. Найдите ваш принтер, кликните правой кнопкой
3. Выберите "Просмотр очереди печати"
4. В меню "Принтер" выберите "Очистить очередь печати"
5. Если не помогло:
   - Нажмите Win+R
   - Введите: services.msc
   - Найдите службу "Диспетчер печати"
   - Кликните правой кнопкой → "Перезапустить"
6. Если все еще не работает:
   - Перезагрузите компьютер
   - Выключите и включите принтер
7. Попробуйте распечатать снова""",
            "keywords": "очередь печати, зависла, не печатает, застряли документы, spooler"
        },

        # Категория: Программное обеспечение
        {
            "category": TicketCategory.SOFTWARE,
            "title": "Ошибка при входе в 1С",
            "problem": "Не могу запустить 1С или войти в базу данных",
            "solution": """1. Проверьте подключение к сети
2. Попробуйте запустить 1С от имени администратора
3. Проверьте выбрана ли правильная база данных
4. Частые ошибки и решения:
   - "База заблокирована" - подождите, идет обновление
   - "Нет связи с сервером" - проверьте VPN подключение
   - "Недостаточно прав" - обратитесь к администратору 1С
5. Очистите кэш 1С:
   - Закройте все окна 1С
   - Найдите папку: %AppData%\\1C\\1Cv8
   - Удалите содержимое папки
6. Перезапустите 1С
7. Если не помогло - создайте заявку с текстом ошибки""",
            "keywords": "1с, ошибка, не запускается, база данных, не могу войти"
        },
        {
            "category": TicketCategory.SOFTWARE,
            "title": "Не устанавливается программа",
            "problem": "Ошибка при установке программного обеспечения",
            "solution": """1. Убедитесь что у вас права администратора
2. Запустите установщик от имени администратора:
   - Правый клик на файле установки
   - "Запуск от имени администратора"
3. Временно отключите антивирус
4. Освободите место на диске C:\\ (нужно минимум 5 ГБ)
5. Проверьте системные требования программы
6. Попробуйте установить в безопасном режиме
7. Если ошибка связана с .NET Framework или Visual C++:
   - Установите эти компоненты отдельно
8. Проверьте журнал ошибок Windows
9. Если программа из корпоративного каталога:
   - Используйте Software Center / Портал самообслуживания
10. Или создайте заявку в IT с описанием ошибки""",
            "keywords": "не устанавливается, ошибка установки, программа, софт, installation error"
        },
        {
            "category": TicketCategory.SOFTWARE,
            "title": "Проблема с лицензией Microsoft Office",
            "problem": "Office просит активацию или показывает ошибку лицензии",
            "solution": """1. Полностью закройте все приложения Office
2. Откройте любое приложение Office (Word, Excel)
3. Нажмите Файл → Учетная запись
4. Проверьте статус подписки
5. Если лицензия не активна:
   - Нажмите "Активировать продукт"
   - Войдите с корпоративной учетной записью
6. Если не помогло, переактивируйте Office:
   - Откройте командную строку от администратора
   - Перейдите в папку Office:
     cd "C:\\Program Files\\Microsoft Office\\Office16"
   - Выполните: cscript ospp.vbs /rearm
7. Перезагрузите компьютер
8. Если проблема осталась - создайте заявку в IT""",
            "keywords": "office, лицензия, активация, не активирован, подписка, word, excel"
        },

        # Категория: Оборудование
        {
            "category": TicketCategory.HARDWARE,
            "title": "Не работает микрофон/камера в Teams/Zoom",
            "problem": "Коллеги не слышат меня или не видят на видеоконференции",
            "solution": """1. Проверьте что устройство подключено
2. В настройках Teams/Zoom:
   - Откройте Настройки → Аудио/Видео
   - Выберите правильное устройство из списка
   - Проверьте уровень звука/тест камеры
3. Проверьте разрешения Windows:
   - Пуск → Параметры → Конфиденциальность
   - Камера / Микрофон
   - Разрешите доступ для приложений
4. Проверьте физическую кнопку отключения на гарнитуре/камере
5. Обновите драйверы:
   - Диспетчер устройств
   - Найдите камеру/микрофон
   - Правый клик → Обновить драйвер
6. Перезапустите приложение
7. Перезагрузите компьютер
8. Попробуйте другую гарнитуру/камеру""",
            "keywords": "микрофон, камера, не работает, teams, zoom, не слышат, не видно"
        },
        {
            "category": TicketCategory.HARDWARE,
            "title": "Синий экран смерти (BSOD)",
            "problem": "Компьютер внезапно показывает синий экран и перезагружается",
            "solution": """1. Запомните или сфотографируйте код ошибки (например: STOP 0x0000007B)
2. После перезагрузки проверьте:
   - Все провода подключены надежно
   - Нет перегрева (почистите вентиляцию)
3. Запустите проверку диска:
   - Откройте командную строку от администратора
   - Введите: chkdsk C: /f /r
   - Подтвердите проверку при следующей перезагрузке
   - Перезагрузите компьютер
4. Проверьте оперативную память (Windows Memory Diagnostic)
5. Обновите драйверы через Диспетчер устройств
6. Удалите недавно установленное ПО
7. Восстановите систему на раннюю точку:
   - Панель управления → Восстановление
   - Запуск восстановления системы
8. Если BSOD повторяется - срочно обратитесь в IT с кодом ошибки""",
            "keywords": "синий экран, bsod, blue screen, перезагрузка, ошибка, зависание"
        },
        {
            "category": TicketCategory.HARDWARE,
            "title": "Переполнен диск C:\\",
            "problem": "Мало места на системном диске, компьютер тормозит",
            "solution": """1. Запустите "Очистка диска":
   - Правый клик на диск C: → Свойства
   - Кнопка "Очистка диска"
   - Отметьте все пункты (особенно "Предыдущие установки Windows")
   - Нажмите OK → Удалить файлы
2. Очистите корзину (правый клик → Очистить корзину)
3. Удалите временные файлы:
   - Win+R → введите: %temp%
   - Удалите все файлы (Ctrl+A → Delete)
4. Проверьте папку "Загрузки" (обычно там много файлов)
5. Удалите ненужные программы:
   - Параметры → Приложения
   - Сортировка по размеру
   - Удалите неиспользуемые
6. Переместите личные файлы на диск D:\\ или сетевое хранилище
7. Используйте TreeSize для анализа места
8. Если после очистки < 10% свободно - обратитесь в IT""",
            "keywords": "переполнен диск, мало места, нет места, диск c, очистка диска, память"
        },
    ]

    # Add all articles to database
    for article_data in knowledge_articles:
        article = KnowledgeBase(**article_data)
        db.add(article)

    db.commit()
    print(f"✅ Successfully added {len(knowledge_articles)} knowledge base articles!")
    db.close()


if __name__ == "__main__":
    seed_knowledge_base()
